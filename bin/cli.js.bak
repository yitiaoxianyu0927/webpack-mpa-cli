#!/usr/bin/env node


//æ ¸å¿ƒå¤„ç†å‘½ä»¤è¡Œ

const program = require("commander");
const printer = require("@darkobits/lolcatjs");
const config = require("./config.js");
const shelljs = require("shelljs");
const chalk = require("chalk");
const inquirer = require("inquirer");
const download = require("download-git-repo");
const ora = require("ora");
const userHome = require("user-home");

console.log(userHome,__dirname);

const template = "direct:https://github.com/yitiaoxianyu0927/webpack-mpa.git"


program.version(printer.default.fromString(`${config.greet}\n0.0.1`),"-v, --version");


// program.command("init","åˆå§‹åŒ–é¡¹ç›®");
const binHandler = {
    
    async init(){

        const { repo } = await inquirer
        .prompt([
            {
                type:"text",
                message:"è¯·è¾“å…¥æ–‡ä»¶å¤¹çš„åå­—",
                name:"projectName"
            },
            {
               type:"list",
               message:"è¯·é€‰æ‹©å¯¹åº”è¯­è¨€",
               choices:["âœ” TypeScript","âœ” EcmaScript"],
               name:"kind"
            }
        ])
        .then(answers => {

            const projectName = answers.projectName;
            
            if(projectName) {

                const spinner = ora("ğŸ”¥ ä¸‹è½½åˆå§‹åŒ–æ¨¡æ¿...");
                spinner.start();
                //ä¸‹è½½githubé¡¹ç›®

                const __dirname = "E:/development/project/npm-group/webpack-test"

                const _projectPath = `${__dirname}/${projectName}`
                shelljs.cd(__dirname)
                shelljs.rm("-rf",_projectPath);
                shelljs.mkdir(projectName);

                //if(error)

                await download(template, _projectPath , { clone:true } , err => {
                    
                    spinner.stop();

                    if(err){

                       console.error("ğŸ˜¥ ä¸‹è½½å¤±è´¥",err.message.trim());

                    }else{
                       
                       shelljs.sed("-i","ytxy-webpack-mpa",projectName,_projectPath+"/package.json") 
                       console.log(chalk.green("ğŸ‘» é¡¹ç›®åˆ›å»ºæˆåŠŸ~")) 

                    }
                })
            }

        })


        console.log("repo",repo);
    }
}
program
    .usage("[cmd] <option>")
    .arguments("<cmd> [env]")
    .action((cmd, otherParms) => {

        const handler = binHandler[cmd];
        if(handler){

            handler();
        
        }else{

            console.log(`${chalk.yellow("éå¸¸é—æ†¾")} ã€${chalk.red(cmd)}ã€‘å‘½ä»¤å¹¶ä¸å­˜åœ¨`);

        }

    })

program.parse(process.argv);